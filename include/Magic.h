#ifndef MAGIC_H
#define MAGIC_H

#include "Attack.h"
#include "BitBoard.h"
#include "MoveGen.h"
#include "MyTypes.h"

typedef struct {
    U64 * ptr;
    U64 mask;
    U64 magic;
    int shift;
} SMagic;

extern U64* attackTable;
extern SMagic bishopAttacks[64];
extern SMagic rookAttacks[64];

U64 BishopMask(int square);
U64 RookMask(int square);
U64 GenerateBlockerFromIndex(int index, U64 mask);
U64 ComputeBishopAttacks(int square, U64 blockers);
U64 ComputeRookAttacks(int square, U64 blockers);
void FillBishopTable(int square);
void FillRookTable(int square);
void InitMagicBitBoards();
void CleanupMagicBitboards();

/*
    Precomputed magic numbers for rook and bishop bitboards.
    These constants are taken from Stockfish's implementation and other public sources,
    which are widely used in chess engine development.
    Each index corresponds to a square on the board (0 = a1, 63 = h8).
    See: https://github.com/official-stockfish/Stockfish
*/

static const U64 rookMagics[64] = {
    0x0080001020400080ULL, 0x0040001000200040ULL, 0x0080081000200080ULL, 0x0080040800100080ULL,
    0x0080020400080080ULL, 0x0080010200040080ULL, 0x0080008001000200ULL, 0x0040004801000200ULL,
    0x0000800020400080ULL, 0x0000400020005000ULL, 0x0000801000205000ULL, 0x0000800800105000ULL,
    0x0000800400085000ULL, 0x0000800200045000ULL, 0x0000800100024000ULL, 0x0000400180024000ULL,
    0x0000204000800080ULL, 0x0000202000400080ULL, 0x0000202010002000ULL, 0x0000202008001000ULL,
    0x0000202004000800ULL, 0x0000202002000400ULL, 0x0000202001000200ULL, 0x0000201000800200ULL,
    0x0000204020004000ULL, 0x0000202000204000ULL, 0x0000202000102000ULL, 0x0000202000081000ULL,
    0x0000202000040800ULL, 0x0000202000020400ULL, 0x0000202000010200ULL, 0x0000201000801000ULL,
    0x0000102040008000ULL, 0x0000082040004000ULL, 0x0000081020002000ULL, 0x0000080810001000ULL,
    0x0000080408000800ULL, 0x0000080204000400ULL, 0x0000080102000200ULL, 0x0000080081000100ULL,
    0x0000041020400080ULL, 0x0000021020400040ULL, 0x0000011020400020ULL, 0x0000008820400010ULL,
    0x0000008440200008ULL, 0x0000008220100004ULL, 0x0000008110080002ULL, 0x00000080C0080001ULL,
    0x0000040102040000ULL, 0x0000020102040000ULL, 0x0000010102040000ULL, 0x0000008182040000ULL,
    0x0000008102040000ULL, 0x0000008082040000ULL, 0x0000008041040000ULL, 0x0000004020820000ULL,
    0x0000040001020400ULL, 0x0000020001020400ULL, 0x0000010001020400ULL, 0x0000008101020400ULL,
    0x0000008081020400ULL, 0x0000008041020400ULL, 0x0000004020820400ULL, 0x0000002080410200ULL
};

static const U64 bishopMagics[64] = {
    0x0040201000402000ULL, 0x0000400800100200ULL, 0x0000040100040100ULL, 0x0000008020801000ULL,
    0x0000002010080400ULL, 0x0000000820040200ULL, 0x0000000208200200ULL, 0x0000000110100100ULL,
    0x0000201000400200ULL, 0x0000020800100200ULL, 0x0000004000801000ULL, 0x0000001000400800ULL,
    0x0000000400200400ULL, 0x0000000208100200ULL, 0x0000000104100100ULL, 0x0000000082080080ULL,
    0x0000201000200080ULL, 0x0000020800100080ULL, 0x0000004000800400ULL, 0x0000001000400200ULL,
    0x0000000400200100ULL, 0x0000000208100080ULL, 0x0000000104100040ULL, 0x0000000082080020ULL,
    0x0000081020008000ULL, 0x0000008208008000ULL, 0x0000002082004000ULL, 0x0000000820402000ULL,
    0x0000000208101000ULL, 0x0000000104100800ULL, 0x0000000082080400ULL, 0x0000000041040200ULL,
    0x0000081000204000ULL, 0x0000008200084000ULL, 0x0000002082002000ULL, 0x0000000820401000ULL,
    0x0000000208100800ULL, 0x0000000104100400ULL, 0x0000000082080200ULL, 0x0000000041040100ULL,
    0x0000020408101000ULL, 0x0000002040801000ULL, 0x0000000820400800ULL, 0x0000000208100200ULL,
    0x0000000104100100ULL, 0x0000000082080080ULL, 0x0000000041040040ULL, 0x0000000020820020ULL,
    0x0000020408100800ULL, 0x0000002040800800ULL, 0x0000000820400400ULL, 0x0000000208100100ULL,
    0x0000000104100080ULL, 0x0000000082080040ULL, 0x0000000041040020ULL, 0x0000000020820010ULL,
    0x0000010204080100ULL, 0x0000001020408010ULL, 0x0000000408204080ULL, 0x0000000102082040ULL
};


#endif